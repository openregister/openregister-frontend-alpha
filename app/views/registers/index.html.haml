- content_for :page_title, 'Registers'

.breadcrumbs{"data-module" => "track-click"}
  %ol
    %li
      = link_to "Service Toolkit", "https://www.gov.uk/service-toolkit", target: :blank
    %li
      = link_to 'Registers', root_path
    - if params[:phase].present?
      %li
        = link_to 'Register pipeline', registers_path
      %li
        = params[:phase]
    - else
      %li Register pipeline


%h1.heading-large View registers

.grid-row
  - if params[:phase].present?
    .column-one-quarter
      .data
        %span.data-item.bold-xxlarge= @registers.size
        %span.data-item.bold-xsmall= params[:phase]
  - else
    .column-one-quarter
      .data
        = link_to registers_path(phase: 'Ready to use') do
          %span.data-item.bold-xxlarge= @registers.where(phase: 'Beta').count
          %span.data-item.bold-xsmall Registers ready for use
    .column-one-quarter
      .data
        = link_to registers_path(phase: 'In progress') do
          %span.data-item.bold-xxlarge= @registers.where.not(phase: 'Beta').count
          %span.data-item.bold-xsmall Registers in progress

.grid-row
  .column-two-thirds.js-enabled
    %div{class: "js-filter-list", "aria-hidden" => "true"}
      %form.js-filter-form
        %fieldset
          .form-group
            %label{class: "form-label", for: "search"} Search for a register
            %input{name: "search", id: "search", class: "form-control form-control-3-4"}

  .column-full
    %h3.heading-small.mq-small-only Sort by:
    %table.register-status-table.table-collapsible
      %thead
        %tr
          %th{role: "columnheader", scope: "col"} Register
          %th{role: "columnheader", scope: "col"} Status
          %th{role: "columnheader", scope: "col"} Managed by
          %th{role: "columnheader", scope: "col"}
      %tbody.js-filter-block
        - @registers.each_with_index do |register, index|
          - index = index + 1
          = render partial: 'registers/register', object: register, locals: { index: index }

= content_for :head do
  %script{src: "//code.jquery.com/jquery-3.2.1.min.js"}
  %script{src: "//cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.28.14/js/jquery.tablesorter.min.js"}

= content_for :javascript do
  :javascript
    jQuery(function($) {
      GOVUK.filterListItems.init();
      $(".register-status-table").tablesorter({ sortList: [[1,1]] });

      $("#filter_results").change(function () {
        if(document.location.href.includes('current')) {
          var url = replaceQueryString(window.location.href, 'current', this.value);
        } else {
          var url = document.location.href + "&current=" + this.value;
        }
        document.location = url;
      });
    });
